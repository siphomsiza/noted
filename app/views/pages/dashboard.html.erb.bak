<% provide(:title, "Dashboard") %>
<div>
  <h2>
    Dashboard
  </h2>
  <div class="row">
    <div class="col col-lg-12">
      <div class="well text-center">
        <span id="date">&nbsp;</span>&nbsp;<span id="clock">&nbsp;</span>
        <br/>
        <span id="weather">
          <img src="../assets/images/spinner_.gif" alt="loading" id="spinner" >
        </span>
        <span id="forecast">
          <noscript>This application requires JavaScript to function. Please enable scripts in your browser.</noscript>
        </span>
      </div>
    </div>
    <div class="col col-lg-12">
      <h3 class="sub-header"><span class="glyphicon glyphicon-user"></span>&nbsp;Users Statistics</h3>
      <div class="row">
        <div class="col-lg-3 col-md-6">
          <div class="panel">
            <div class="panel-heading">
              <div class="row">
                <div>
                  <div class="c100 p<%= @users.count %>">
                    <span><%= @users.count %></span>
                    <div class="slice">
                      <div class="bar"></div>
                      <div class="fill"></div>
                    </div>
                  </div>
                </div>
                <div>All Users</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="panel">
            <div class="panel-heading">
              <div class="row">
                <div>
                  <div class="c100 p<%= @users.where(admin: true).count %> red">
                    <span><%= @users.where(admin: true).count %></span>
                    <div class="slice">
                      <div class="bar"></div>
                      <div class="fill"></div>
                    </div>
                  </div>
                </div>
                <div>Admin Users</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="panel">
            <div class="panel-heading">
              <div class="row">
                <div>
                  <div class="c100 p<%= @users.where(activated: true).count %> green">
                    <span><%= @users.where(activated: true).count %></span>
                    <div class="slice">
                      <div class="bar"></div>
                      <div class="fill"></div>
                    </div>
                  </div>
                </div>
                <div>Active Users</div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="panel">
            <div class="panel-heading">
              <div class="row">
                <div>
                  <div class="c100 p<%= @users.where(activated: false).count %> orange">
                    <span><%= @users.where(activated: false).count %></span>
                    <div class="slice">
                      <div class="bar"></div>
                      <div class="fill"></div>
                    </div>
                  </div>
                </div>
                <div>Inactive Users</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col col-lg-12">
      <h3>Total Performance Standards for Mkhondo Municipality</h3>
      <div class="panel panel-default col-md-6">
        <div class="panel-body">
          <%= pie_chart @departmental_sdbips.group(:performance_standard).count, width: "400px", height: "250px" %>
        </div>
        <!-- /.panel-body -->
      </div>
      <div class="panel panel-default col-md-6">
        <div class="panel-body">
          <%= bar_chart @departmental_sdbips.group(:performance_standard).count, width: "400px", height: "250px" %>
        </div>
        <!-- /.panel-body -->
      </div>
    </div>
    <div class="col col-lg-12">
      <h3>Total Performance Standards by Department</h3>
      <div class="panel panel-default">
        <div class="panel-body">
          <%= column_chart @departmental_sdbips.group(:department_id,:performance_standard).count, width: "95%", height: "400px" %>
        </div>
        <!-- /.panel-body -->
      </div>
    </div>
    <div class="col col-lg-12">
      <h3 class="sub-header"><span class="glyphicon glyphicon-time"></span>&nbsp;SDBIP Time Periods</h3>
    </div>
    <div class="col col-lg-12">
      <h3 class="sub-header"><span class="glyphicon glyphicon-list-alt"></span>&nbsp;Activity Log</h3>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>User</th>
              <th>Activity</th>
              <th>Location(IP Address)</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <% User.where(admin: true).each do |activity|%>
            <tr>
              <td><%= activity.firstname %></td>
              <td><%= activity.created_at %></td>
              <td><%= activity.updated_at %></td>
              <td><%= activity.created_at %></td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  function updateClock ( )
  {
    var currentTime = new Date ( );

    var currentHours = currentTime.getHours ( );
    var currentMinutes = currentTime.getMinutes ( );
    var currentSeconds = currentTime.getSeconds ( );
    var currentYear = currentTime.getFullYear();
    var currentDate = currentTime.getDate();

    var d = new Date();
    var weekday = new Array(7);
    weekday[0]=  "Sunday";
    weekday[1] = "Monday";
    weekday[2] = "Tuesday";
    weekday[3] = "Wednesday";
    weekday[4] = "Thursday";
    weekday[5] = "Friday";
    weekday[6] = "Saturday";

    var n = weekday[d.getDay()];

    var date = new Date();
    var month = new Array();
    month[0] = "January";
    month[1] = "February";
    month[2] = "March";
    month[3] = "April";
    month[4] = "May";
    month[5] = "June";
    month[6] = "July";
    month[7] = "August";
    month[8] = "September";
    month[9] = "October";
    month[10] = "November";
    month[11] = "December";
    var currentMonth = month[date.getMonth()];
    // Pad the minutes and seconds with leading zeros, if required
    //currentMinutes = ( currentMinutes < 10 ? "0" : "" ) + currentMinutes;
    //currentSeconds = ( currentSeconds < 10 ? "0" : "" ) + currentSeconds;

    // Choose either "AM" or "PM" as appropriate
    //var timeOfDay = ( currentHours < 12 ) ? "AM" : "PM";

    // Convert the hours component to 12-hour format if needed
    //currentHours = ( currentHours > 12 ) ? currentHours - 12 : currentHours;

    // Convert an hours component of "0" to "12"
    //currentHours = ( currentHours == 0 ) ? 12 : currentHours;

    if(currentSeconds<=9) currentSeconds ="0"+currentSeconds;
    if(currentMinutes<=9) currentMinutes ="0"+ currentMinutes;
    if(currentHours<=9) currentHours ="0"+ currentHours;

    // Compose the string for display
    var currentTimeString = currentHours + ":" + currentMinutes + ":" + currentSeconds;// + " " + timeOfDay;
    var currentDateString = n + " " + currentMonth + " " + currentDate + " " +currentYear;

    // Update the time display
    document.getElementById("clock").firstChild.nodeValue = currentTimeString;
    // Update the date display
    document.getElementById("date").firstChild.nodeValue = currentDateString;
  }

  $(document).ready(function() {
	  //Setup the plugin, see readme for more examples
	  var weather_service = $("#weather").flatWeatherPlugin({
	     location: "Midrand, Johannesburg", //city and region *required
	      country: "South Africa",         //country *required
	      //optional:
	      api: "openweathermap", //default: openweathermap (openweathermap or yahoo)
	      //apikey: "your-api-key",   //optional api key for openweather
	      view : "simple", //default: full (partial, full, simple, today or forecast)
	      displayCityNameOnly : true, //default: false (true/false) if you want to display only city name
	      forecast: 1, //default: 5 (0 -5) how many days you want forecast
	      render: true, //default: true (true/false) if you want plugin to generate markup
	      loadingAnimation: true //default: true (true/false) if you want plugin to show loading animation
	      //units : "metric" or "imperial" default: "auto"
	   });
  });
</script>
