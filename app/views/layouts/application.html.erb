<!DOCTYPE html>
<html>
  <head>
    <title><%= full_title(yield(:title)) %></title>
    <%= stylesheet_link_tag    'application', media: 'all' %>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <%= javascript_include_tag "http://www.google.com/jsapi", "chartkick" %>
    <%= stylesheet_link_tag "application", media: "all","data-turbolinks-track" => true %>
    <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
    <%= javascript_include_tag 'jquery' %>
    <%= csrf_meta_tags %>
    <%= render 'layouts/shim' %>
    <%= google_webfonts_init({
        google: ['Josefin Sans', 'PT Sans']
      }) %>
  </head>

  <body id="applicationmanifest">
    <% if current_user %>
    <%= auto_session_timeout_js frequency: 5 %>
    <% end %>
    <div id="modal-holder"></div>
    <section class="container-fluid">
      <div class="content row">
        <div class="col col-lg-12">
          <% if logged_in? %>
          <%= render partial: 'layouts/header', :locals => {:doc => @doc} %>
          <% end %>
        </div>
        <div class="main col col-lg-12">
          <% flash.each do |message_type, message| %>
          <%= content_tag(:div, message, class: "alert alert-#{message_type}") %>
          <% end %>
          <%= yield %>
        </section>
        <!-- main -->
      </div>
      <!-- content -->
      <% if logged_in? %>
      <%= render 'layouts/footer' %>
      <% end %>
    </div>
    <div class="modal fade" id="logout_popup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <div style="width:100%;height:100%;margin: 0px; padding:0px">
          <div style="width:25%;margin: 0px; padding:0px;float:left;">
            <i class="fa fa-warning" style="font-size: 140px;color:#da4f49"></i>
          </div>
          <div style="width:70%;margin: 0px; padding:0px;float:right;padding-top: 10px;padding-left: 3%;">
            <h4>Your session is about to expire!</h4>
            <p style="font-size: 15px;">You will be logged out in <span id="timer" style="display: inline;font-size: 30px;font-style: bold">10</span> seconds.</p>        
            <p style="font-size: 15px;">Do you want to stay signed in?</p>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
      <div style="margin-left: 30%;margin-bottom: 20px;margin-top: 20px;">
        <a href="javascript:;" onclick="resetTimer()" class="btn btn-primary" aria-hidden="true">Yes, Keep me signed in</a>
        <a href="<?php echo BASE_PATH.'logout.php';?>" class="btn btn-danger" aria-hidden="true">No, Sign me out</a>
      </div>
    </div>
  </div>
</div>
    <!-- container -->
   <script type="text/javascript" src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js"></script>
  </body>
</html>
<script>
  $(document).ready(function () {
    if (window.location.pathname == "/edit_user_profile") {
      $('#user_details_modal').modal('show');
    }
  });
</script>
<script type="text/javascript">
  $(document).ready(function () {
    // var elements = document.getElementByClassName("datatable");
    // for(var i =0, i < elements.length, i){
    //
    // }
var c = 0; max_count = 10; logout = true;
startTimer();
function startTimer(){
  setTimeout(function(){
    logout = true;
    c = 0;
    max_count = 10;
    $('#timer').html(max_count);
    $('#logout_popup').modal('show');
    startCount();

  }, 1000);
}

function resetTimer(){
  logout = false;
  $('#logout_popup').modal('hide');
  startTimer();
}

function timedCount() {
    c = c + 1;
    remaining_time = max_count - c;
    if( remaining_time == 0 && logout ){
      $('#logout_popup').modal('hide');
    location.href = $('#logout_url').val();

  }else{
      $('#timer').html(remaining_time);
      t = setTimeout(function(){timedCount()}, 1000);
  }
}

function startCount() {
   timedCount();
}
    $('#active-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#inactive-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#new-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#locked-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#terminated-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#all-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#user-details').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#user-details-log').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#login-attempts-log').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#super-user-activity-logs').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#user-activity-logs').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#user-access').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#admin-users').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#sdbips-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#edit-kpi-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#update-kpi-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#deleted-kpi-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#view-toplayer-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#edit-toplayer-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#update-toplayer-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#view-capitalproject-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#edit-capitalproject-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#update-capitalproject-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#view-monthlycashflows-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#edit-monthlycashflows-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#update-monthlycashflows-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#view-revenuebysource-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#edit-revenuebysource-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#update-revenuebysource-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#view-assurance-datatable').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
    $('#kpi-owners-table').DataTable({
      dom: 'Bfrtip',
      buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5']
    });
  });
</script>
