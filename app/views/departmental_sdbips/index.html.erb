<% provide(:title, 'All Departmental SDBIPs') %>
<script>
$(function() {
	//highlight the current nav
	$("#applicationmanifest ul.navbar-nav li:eq(3)").addClass('active');
}); //jQuery is loaded
</script>
<br/>
<div class="row">
<div class="col col-lg-12">
<%= render 'layouts/municipality' %>
</article>

<ul class="nav nav-pills nav-justified">

<li class="active"><%= link_to "Departmental SDBIP", departmental_sdbips_path %></li>
<% if current_user.admin? %>
<li><%= link_to "Top Layer SDBIP", top_layer_sdbips_path %></li>
<li><%= link_to "Capital Projects", capital_projects_path %></li>
<li><%= link_to "Monthly Cashflow", monthly_cashflows_path %></li>
<li><%= link_to "Revenue By Source", revenue_by_sources_path %></li>

<% end %>

</ul>

</div>

</div>
		<div class="row">
			<div id="departmentalsdbips">
					<div class="col col-lg-12">
						<div class="tabbable tabs" id="departmental_sdbips-tabs">
							<ul id = "myTab" class = "nav nav-tabs">
								<li class="active">
									<a href = "#new_sdbip" data-toggle = "tab">
										<span class="glyphicon glyphicon-plus-sign"></span>&nbsp;Add KPI
									</a>
								</li>
								<li>
									<a href = "#view_sdbips" data-toggle = "tab"><span class="glyphicon glyphicon-list-alt"></span>&nbsp;View KPIs</a>
								</li>
								<li>
									<a href = "#manage_sdbips" data-toggle = "tab"><span class="glyphicon glyphicon-list-alt"></span>&nbsp;Manage KPIs</a>
								</li>
							</ul><!-- nav nav-tabs -->
						</div><!-- tabbable tabs -->

						<div id = "myTabContent" class = "tab-content">
							<div class = "tab-pane active fade in" id = "new_sdbip">
								<% if current_user.admin? %>
								<div class="row"><br/>
									<div class="col col-lg-12">
												<button class="btn pull-right" data-toggle="modal" data-target="#importModal" title="Click to upload SDBIP.">
													<span class="glyphicon glyphicon-upload"></span>&nbsp;Import SDBIP</button>&nbsp;
											</div>
								</div>
											<hr/>
											<% end %>
											<h2>New Departmental KPI</h2>
									<% if current_user.admin? %>
											<%= render 'form' %>
									<% else %>
										<p align="center">You're not eligible to create SDBIPs.</p>
									<% end %>
							</div>

							<div class = "tab-pane active fade" id = "view_sdbips">
								<ul class="sdbips">
									<% if @departmental_sdbips.blank? && DepartmentalSdbip.blank? %>
									<p> There are no Departmental SDBIPs currently in the system <p>
									<% elsif @departmental_sdbips.blank? && !DepartmentalSdbip.blank? %>
									<p> You currently have no Departmental SDBIP </p>
									<% else %>
									<div class="row">
										<div class="col col-lg-12">
									<div class="btn-group pull-right">
												<button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
													<span class="glyphicon glyphicon-download"></span>&nbsp;Export SDBIP
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu" role="menu">
													<li><%= link_to "CSV format", departmental_sdbips_path(format: "csv") %></li>
													<li><%= link_to "Excel format", departmental_sdbips_path(format: "xls") %></li>
												</ul>
											</div><br/>
											<hr/>
										</div>

									<%= form_tag departmental_sdbips_path, method: :get do %>
										<div class="row">
											<div class="col-lg-12">
												<div class="col-lg-3">
													<label class="col control-label">Who:</label>&nbsp;<%= select_tag :subdepartment_id, grouped_options_for_select(@departments.map{ |group| [group.name, group.subdepartments.map{ |c| [c.subdepartment_name, c.id] } ] }),{class:'form-control'} %>
												</div>
												<div class="col-lg-3">
													<label class="col control-label">What:</label>&nbsp;<%= select_tag :kpi_type_id,options_for_select([["All KPIs","0"]]+@kpitypes.all.collect {|x| [ x.name, x.id ] },id:'kpi_select'),prompt:'Select KPI Type',class: "form-control" %>
												</div>
												<div class="col-lg-2">
												<label class="col control-label">When:</label>&nbsp;<%= date_field(:start_date, nil,placeholder: 'Select Start Date',:class => 'form-control input-sm') %>
												</div>
												<div class="col-lg-2">
													<label class="col control-label">To:</label>&nbsp;<%= date_field(:end_date,nil,placeholder: 'Select End Date',:class => 'form-control input-sm') %>
												</div>
												<div class="col-lg-1">
													<%= submit_tag "Apply", class: "btn btn-sm", :department_id => nil %>
												</div>
											</div>
										</div>
									<% end %>
									<h3><a href="#" data-toggle="collapse" data-target="#grpChkBox" title="Click link to display custom view functionality." id="filter_toggle"><span class="glyphicon glyphicon-eye-open"></span>&nbsp;Custom View</a></h3>
								<div id="grpChkBox" class="collapse"><hr/>
								<div class="row">
								<div class="col-lg-12">
								<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="kpi-owner-checkbox" name="kpi-owner" value="">&nbsp,&nbsp;&nbsp;&nbsp;KPI Owner</label>
								</div>
							<div class="checkbox  col-lg-2">
								<label><input type="checkbox" id="unit-of-measurement" name="unit-of-measurement" value="">&nbsp,&nbsp;&nbsp;&nbsp;Unit of Measurement</label>
							</div>
							<div class="checkbox col-lg-2"> <label><input type="checkbox" id="mscore-classification" name="mscore-classification" value="">&nbsp,&nbsp;&nbsp;&nbsp;M-score Classification</label> </div>
							<div class="checkbox col-lg-2"> <label><input type="checkbox" id="idp-ref" name="idp-ref" value="">&nbsp,&nbsp;&nbsp;&nbsp;IDP Ref</label> </div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="national-outcome" name="national-outcome" value="">&nbsp,&nbsp;&nbsp;&nbsp;National Outcome</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="kpi-concept" name="kpi-concept" value="">&nbsp,&nbsp;&nbsp;&nbsp;KPI Concept</label>
							</div>
							</div>
							</div>
							<div class="row">
							<div class="col-lg-12">
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="strategic-objectives" name="strategic-objectives" value="">&nbsp,&nbsp;&nbsp;&nbsp;Strategic Objectives</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="source-of-evidence" name="source-of-evidence" value="">&nbsp,&nbsp;&nbsp;&nbsp;Source of Evidence</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="baseline" name="baseline" value="">&nbsp,&nbsp;&nbsp;&nbsp;Baseline</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="risk-rating" name="risk-rating" value="">&nbsp,&nbsp;&nbsp;&nbsp;Risk Rating</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="ndp-objectives" name="ndp-objectives" value="">&nbsp,&nbsp;&nbsp;&nbsp;NDP Objectives</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="reporting-category" name="reporting-category" value="">&nbsp,&nbsp;&nbsp;&nbsp;Reporting Category</label>
							</div>
							</div>
							</div>
							<div class="row">
							<div class="col-lg-12">
								<div class="checkbox col-lg-2">
									<label><input type="checkbox" id="annual-target" name="annual-target" value="">&nbsp,&nbsp;&nbsp;&nbsp;Annual Target</label>
								</div>
								<div class="checkbox col-lg-2">
									<label><input type="checkbox" id="revised-target" name="revised-target" value="">&nbsp,&nbsp;&nbsp;&nbsp;Revised Target</label>
								</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="first-quarter-target" name="first-quarter-target" value="">&nbsp,&nbsp;&nbsp;&nbsp;1st Quarter Target</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="second-quarter-target" name="second-quarter-target" value="">&nbsp,&nbsp;&nbsp;&nbsp;2nd Quarter Target</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="third-quarter-target" name="third-quarter-target" value="">&nbsp,&nbsp;&nbsp;&nbsp;3rd Quarter Target</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="fourth-quarter-target" name="fourth-quarter-target" value="">&nbsp,&nbsp;&nbsp;&nbsp;4th Quarter Target</label>
							</div>

							</div>
					</div>

							<div class="row">
							<div class="col-lg-12">

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="capital-project" name="capital-project" value="">&nbsp,&nbsp;&nbsp;&nbsp;Capital Project</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="impact" name="impact" value="">&nbsp,&nbsp;&nbsp;&nbsp;Impact</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="provincial-strategic-outcome" name="provincial-strategic-outcome" value="">&nbsp,&nbsp;&nbsp;&nbsp;Provincial Strategic Outcome</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="performance-standard" name="performance-standard" value="">&nbsp,&nbsp;&nbsp;&nbsp;Performance Standard</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="area" name="area" value="">&nbsp,&nbsp;&nbsp;&nbsp;Area</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="ward" name="ward" value="">&nbsp,&nbsp;&nbsp;&nbsp;Ward</label>
							</div>
						</div>
					</div>

							<div class="row">
							<div class="col-lg-12">

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="past-year-performance" name="past-year-performance" value="">&nbsp,&nbsp;&nbsp;&nbsp;Past Year performance</label>
							</div>

							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="top-layer-ref" name="top-layer-ref" value="">&nbsp,&nbsp;&nbsp;&nbsp;Top layer KPI Ref</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="kpi-calculation-type" name="kpi-calculation-type" value="">&nbsp,&nbsp;&nbsp;&nbsp;KPI Calculation Type</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="start-date" name="start-date" value="">&nbsp,&nbsp;&nbsp;&nbsp;Start Date</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="end-date" name="end-date" value="">&nbsp,&nbsp;&nbsp;&nbsp;End Date</label>
							</div>
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" id="created-date" name="created-date" value="">&nbsp,&nbsp;&nbsp;&nbsp;Created Date</label>
							</div>

					</div>
			</div>
							<div class="row">
							<div class="col-lg-12">
							<div class="checkbox col-lg-2">
								<label><input type="checkbox" name="updated-date" id="updated-date" value="">&nbsp,&nbsp;&nbsp;&nbsp;Updated Date</label>
							</div>
							<div class="checkbox col-lg-2">

							</div>
							<div class="checkbox col-lg-2">

							</div>

							<div class="checkbox col-lg-2">

							</div>

						</div>
							</div>
							</div>
							</div>

								<% end %>	<br/>
									<div class="col col-lg-12">

										<% if !@departmental_sdbips.blank? %>

										<%= render "sdbips" %>

										<% end %>
									</div>
								</ul>
										<%= will_paginate @departmental_sdbips, :class=>"center" %>
							</div>

							<div class = "tab-pane fade" id = "manage_sdbips">
									<h3></h3>
									<% if @departmental_sdbips.blank? && DepartmentalSdbip.blank? %>
									<p> There are no Departmental SDBIPs currently in the system <p>
									<% elsif @departmental_sdbips.blank? && !DepartmentalSdbip.blank? %>
									<p> You currently have no Departmental SDBIP </p>
									<% else %>
									<div class="row">
									<div class="col col-lg-12">

										<% if !@departmental_sdbips.blank? %>

										<%= render "edit_sdbips" %>

										<% end %>
									</div></div>

										<%= will_paginate @departmental_sdbips, :class=>"center" %>
										<% end %>

							</div>
			</div>

					<div class="col col-lg-12">
						<!-- Import SDBIP modal -->
						<div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="importModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<%= form_tag import_departmental_sdbips_path, accept: 'text/csv,text/xls,text/xlsx,text/ods', multipart: true do %>
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
												&times;
											</button>
											<h4 class="modal-title" id="importModalLabel">
												<ol class="breadcrumb">
													<li><a href="#" data-dismiss="modal">SDBIP</a></li>
													<li class="active">Importing SDBIP</li>
												</ol>
											</h4>
											<%= label_tag :NB,"Note: Supported files types are xls,xlsx, ods and csv types.", id: 'import_info' %>
										</div>
										<div class="modal-body">
											<%= label_tag :file,"Select File to upload:" %>
											<%= file_field_tag :file ,{:class=>"form-control"} %>
										</div>
										<div class="modal-footer">
											<div class="col-md-4 pull-right">
												<%= submit_tag "Import", :class=>"btn btn-midi" %>
											</div>
										</div>
									<% end %>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
					</div>
				</div>
			</div>

			<script>
						 $(function () {
								 var $chk = $("#grpChkBox input:checkbox");
								 var $tbl = $("#sdbips-table");
								 $chk.prop('checked', true);
								 $chk.click(function () {
										 var colToHide = $tbl.find("." + $(this).attr("name"));
										 $(colToHide).toggle();
								 });
						 });
				 </script>


	</div>

	</div>
	</div>
