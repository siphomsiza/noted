<% provide(:title, "Listing Departments") %>
<script>
$(function() {
	//highlight the current nav
	$("#applicationmanifest a:contains('SETUP')").parent().addClass('active');
}); //jQuery is loaded
</script>
<div>
<div class="row">
<div class="col col-lg-">
<ul class="nav nav-pills nav-justified">
<li><%= link_to "Master System Setup", master_setups_path, :class => "btn btn-xs pull-right" %></li>
<li> <% if @setups.blank? %>
        <%= link_to "System Setup", setups_path, :class => "btn btn-xs pull-right" %>
      <% elsif @setups.blank? && Setup.blank? %>
        <p>There is currently no setup configured.</p>
      <% end %></li>
<li class="active"><%= link_to "Departments", departments_path, :class =>"btn btn-xs pull-right"%></li>
<li><%= link_to "Departmental Administrators", roles_path, :class =>"btn btn-xs pull-right"%></li>
<li><%= link_to "Top Layer Administrators", roles_path, :class =>"btn btn-xs pull-right"%></li>
<li><%= link_to "Headings", headings_path, :class =>"btn btn-xs pull-right"%></li>
<li><%= link_to "Lists", lists_path, :class =>"btn btn-xs pull-right"%></li>
<li><%= link_to "Time Periods", sdbip_time_periods_path, :class =>"btn btn-xs pull-right"%></li>
</ul></div></div></div>
 <div class="row">

            <div class="tabbable tabs" id="departments-tabs">
              <ul id = "myTab" class = "nav nav-tabs">
								<li class="active">
                  <a href = "#add_departments" data-toggle = "tab">Create</a>
                </li>
                <li>
                  <a href = "#departments" data-toggle = "tab">Manage</a>
                </li>
              </ul><!-- nav nav-tabs -->
            </div><!-- tabbable tabs -->
    <div id = "myTabContent" class = "tab-content">
			<div class="tab-pane active fade in" id="add_departments">
				<br/>
				<h3>New Department</h3>
				<hr/>
				<%= render "form" %>
			</div>
     <div class = "tab-pane fade" id = "departments">
      <table class="table table-hover table-striped">
        <thead>
          <tr>
          <th>&nbsp;</th>
            <th>Department</th>
						  <th>Sub-departments</th>
            <th>Telephone Number</th>
            <th>Fax Number</th>

            <th colspan="2"></th>
          </tr>
        </thead>
        <tbody>
        <% @departments.each do |department| %>
          <tr class="<%= cycle('odd', 'even') %>">
           <td><%= department.id %></td>
            <td><%= department.name %></td>
						<td>
						<ol><% department.subdepartments.each do |subdepartment| %>
						  <li><%=  subdepartment.subdepartment_name %></li>
							<% end %></ol>
						</td>
             <td><%= link_to number_to_phone(department.tel_no, :area_code => true, :delimiter => ' ') %></td>
              <td><%= link_to number_to_phone(department.fax_no, :area_code => true, :delimiter => ' ') %></td>

           <!--<td><%= link_to department, class: "btn btn-mini" do %>
              <span class="glyphicon glyphicon-list-alt"></span>&nbsp;Show
            <% end %></td>-->
            <td>
            <% if current_user.admin? %>
            <%= link_to edit_department_path(department),remote: true,'data-target' => "#departments-modal", 'data-toggle' => 'modal', class: "btn btn-mini" do %>
              <span class="glyphicon glyphicon-pencil"></span>Edit
            <% end %>
            <% end %>

            <div id="departments-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">

          </div>
            </td>
            <td>
            <% if current_user.admin? %>
            <%= link_to department, method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-mini" do %>
              <span class="glyphicon glyphicon-remove-sign"></span>Delete
            <% end %>
            <% end %>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
      <%= will_paginate @departments, :remote=>true, :class=>"center" %>
  </div>

</div>
</div>
