<div class="tab-pane fade" id="generate_graphs">
  <div class="row">
    <br/>
    <h3>Generate Graph Report</h3>
    <div class="panel panel-default col-lg-12">
  <%= form_tag departmental_sdbip_progresses_path, method: :get do %>
    <fieldset id="select-info">
	    <legend><br/>1. Select the filters you wish to apply:</legend>
      <div class="form-group col col-lg-12">
        <label>[Sub-]Department:</label>
        <%= select_tag :department_id, options_for_select([["--Select Department--","-1"],["Entire Municipality","0"]] + Department.all.collect {|p| [ p.name, p.id ] }),{:class=>'form-control'} %>
      </div>
      <div class="form-group row col col-lg-12">
        <div class='col-lg-4'>
          <div>
            <label>Time Period From:</label>
            <div class="input-group date" data-provide="datepicker"
                 data-date-format="M-yyyy" data-date-start-view="months" data-date-min-view-mode="months">
              <input type="text" class="form-control">
              <div class="input-group-addon">
                <span class="glyphicon glyphicon-calendar"></span>
              </div>
            </div>
          </div>
        </div>
        <div class='col-lg-4'>
          <div>
            <label>To:</label>
            <div class="input-group date" data-provide="datepicker"
                 data-date-format="M-yyyy" data-date-start-view="months" data-date-min-view-mode="months">
              <input type="text" class="form-control">
              <div class="input-group-addon">
                <span class="glyphicon glyphicon-calendar"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
        <div class="form-group col col-lg-12"><br/>
          <label class="control-label">Reporting Category:</label>
          <%= select_tag :reporting_category, options_for_select(["--Select Reporting Category--"] + ReportingCategory.all.collect {|p| [ p.name, p.id ] }),{:class=>'form-control'} %>
        </div>
        <div class="form-group col col-lg-12">
          <label class="control-label">KPI Filter:</label>
          <%= select_tag :performance_standard, options_for_select(["KPI Not Yet Measured","KPI Not Met", "KPI Almost Met", "KPI Met", "KPI Well Met", "KPI Extremely Well Met"]),{:class=>'form-control'} %>
        </div>
	  </fieldset><!-- personal info -->

    <fieldset id="choose-group">
	    <legend>2. Select the layout:</legend>
      <div class="form-group col col-lg-12">
        <div class="col-lg-3">
      <%= label_tag :include_sub_graphs, class: "checkbox inline" do %>
        <%= check_box_tag :include_sub_graphs %>
        <span class="control-label">Include Sub-graphs</span>
      <% end %>
    </div>
    </div>
    <div class="form-group col col-lg-12">
      <label class="control-label">Group By:</label>
      <%= select_tag :group_by, options_for_select([["Directorate","0"],["Sub-Directorate","1"],["Performance Standard","2"],["KPA","3"]]),{:class=>'form-control'} %>
    </div>

    <div class="form-group col col-lg-12">
      <label class="control-label">Graph Type:</label>
      <%= select_tag :graph_type, options_for_select([["--Select Graph Type--",""],["Bar Graph","0"],["Pie Chart","1"]]),{:required=>true,:class=>'form-control'} %>
    </div>

	  </fieldset><!-- personal info -->

    <fieldset id="generate-report">
	    <legend>3. Generate the report:</legend>
      <div class="form-group col col-lg-12">
        <label class="control-label">Report Title:</label>
        <div>
          <%= text_field_tag :file_name,nil,{:class => "form-control"}%>

        </div>
      </div>
      <div class="form-group col col-lg-12">
        <%= submit_tag "Generate",{:selected_columns => nil, :id => "submit-btn", 'data-target'=>"audit_log_modal", 'data-toggle'=>"modal",:class=>"btn btn-midi col-lg-2 pull-right"} %>&nbsp;&nbsp;
        </div>
	  </fieldset><!-- personal info -->
	<% end %>
</div>
</div>
</div>
<script>
$('#submit-btn').click(function() {
  $.ajax({
    type: post,
    url: '/departmental_sdbip_progresses',
    data: "your_data",
    success: function() {
      $('#myModal').show();
    }
  })
})
</script>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title" id="myModalLabel">Graph Preview</h4>
            </div>
            <div class="modal-body">
              <div class="row">
  <br/>
  <h3>Mkhondo Municipality LM</h3>
  <div class="panel panel-default col-md-12">
		<div class="panel-body">
			<div class="col-md-12">
	        <%= pie_chart @departmental_sdbips.group(:performance_standard).count, width: "80%", height: "300px", colors: ["orange","darkblue", "limegreen", "red", "darkgreen"] %>
	    </div>
		</div>
		<!-- /.panel-body -->
	</div>
</div>
<div class="row">
	<div class="panel panel-default col-lg-12">
		<div class="panel-heading">
			<h3>Total Performance Standards by Department</h3>
		</div>
		<div class="panel-body">
      <%= column_chart @departmental_sdbips.group(:performance_standard, :department_name).count, height: "400px", stacked: true, colors: ["orange","darkblue", "limegreen", "red", "darkgreen"]%>
		</div>
		<!-- /.panel-body -->
	</div>
</div>


<div class="row">
	<div class="panel panel-default col-lg-12">
		<div class="panel-heading">
			<h3>Summary of Results</h3>
		</div>
		<div class="panel-body">
			<table class="table table-hover">


        <tr>
          <th>Summary of Results</th>
          <th>All KPIs</th>
          <th>All KPIs Percentages</th>
          <th>Total KPIs Measured</th>
          <th>Measured KPIs Percentages</th>
          <th colspan="3"></th>
        </tr>



        <tr>
          <td>KPI Not Yet Measured</td>
          <td><%= @kpi_not_yet_measured.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %><%= (@kpi_not_yet_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>KPI Not Met</td>
          <td><%= @kpi_not_met.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_not_met.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td><%= (@kpi_not_met.count) %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
        </tr>
        <tr>
          <td>KPI Almost Met</td>
          <td><%= @kpi_almost_met.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_almost_met.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td><%= (@kpi_almost_met.count) %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
        </tr>
        <tr>
          <td>KPI Met</td>
          <td><%= @kpi_met.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_met.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td><%= (@kpi_met.count) %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
        </td>
        </tr>
        <tr>
          <td>KPI Well Met</td>
          <td><%= @kpi_well_met.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_well_met.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td><%= (@kpi_well_met.count) %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
        </td>
        </tr>
        <tr>
          <td>KPI Extremely Well Met</td>
          <td><%= @kpi_extremely_well_met.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_extremely_well_met.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td><%= (@kpi_extremely_well_met.count) %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
        </tr>
        <td>Total KPIs</td>
          <td><%= @get_all_kpis.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@get_all_kpis.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
          <td><%= @kpi_measured.count %></td>
          <td>
            <% if @get_all_kpis.count > 0 %>
            <%= (@kpi_measured.count * 100)/(@get_all_kpis.count.nonzero? || 1) %> %
            <% end %>
          </td>
        </tr>

    </table>
		</div>
		<!-- /.panel-body -->
	</div>
</div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

            </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal -->
</div>
